<nb-layout>
  <nb-layout-header fixed class="header-corporate">
    <div class="logo-container" (click)="searchTerm = ''; loadCoins();">
      <img [src]="getAsset('/logo.png')" alt="ngx-admin-demo" class="logo-img" />
      <span class="logo-text">ngx-admin-demo</span>
    </div>

    <div class="search-container">
      <nb-form-field>
        <nb-icon nbPrefix icon="search-outline"></nb-icon>
        <input nbInput placeholder="–ü–æ—à—É–∫ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç..." [(ngModel)]="searchTerm" (keyup.enter)="searchCoins()" />
      </nb-form-field>
    </div>
  </nb-layout-header>

  <nb-layout-column>
    <div *ngIf="isLoading" class="spinner-container">
      <nb-spinner status="primary" size="medium"></nb-spinner>
    </div>

    <nb-alert *ngIf="!isLoading && filterCryptocurrencies().length === 0" status="warning" outline>
      –ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –°–ø—Ä–æ–±—É–π—Ç–µ —ñ–Ω—à–∏–π –∑–∞–ø–∏—Ç.
    </nb-alert>

    <div class="crypto-list" *ngIf="!isLoading && filterCryptocurrencies().length > 0">
      <div *ngFor="let crypto of filterCryptocurrencies()" class="crypto-card" (click)="selectCoin(crypto.id)"
        [@fadeIn]>
        <div class="crypto-card-header">
          <img [src]="crypto.image" alt="{{ crypto.name }}" class="crypto-icon" />
          <div class="crypto-name">{{ crypto.name }}</div>
        </div>

        <div class="price-info">
          <div class="price-current" [ngClass]="getPriceChangeClass(crypto)">
            {{ convertCurrency(crypto.current_price, 'USD') }}
            <nb-icon *ngIf="getPriceChangeClass(crypto) === 'price-up'" icon="trending-up-outline"
              status="success"></nb-icon>
            <nb-icon *ngIf="getPriceChangeClass(crypto) === 'price-down'" icon="trending-down-outline"
              status="danger"></nb-icon>
          </div>
          <div>–¶—ñ–Ω–∞ (UAH): {{ convertCurrency(crypto.current_price, 'UAH') }}</div>
          <div>–†–∏–Ω–∫–æ–≤–∞ –∫–∞–ø—ñ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è: ${{ crypto.market_cap | number : '1.0-0' }}</div>

          <div class="market-stats">
            <div>–û–±—Å—è–≥ 24–≥: ${{ crypto.total_volume | number : '1.0-0' }}</div>
            <div>
              –ó–º—ñ–Ω–∞ 24–≥:
              <span [ngClass]="getPriceChangeClass(crypto)">
                {{ crypto.price_change_percentage_24h | number : '1.2-2' }}%
              </span>
            </div>
          </div>

          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="calculateProgress(crypto.price_change_percentage_24h)"></div>
          </div>

          <canvas class="sparkline-chart" [attr.id]="'sparkline-' + crypto.id" width="100" height="30"></canvas>
        </div>

        <div class="card-footer">
          <a nbButton size="small" status="primary" outline [routerLink]="['/coin', crypto.id]"
            class="btn-primary-outline" (click)="$event.stopPropagation()">üìà –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫</a>
        </div>
      </div>
    </div>
    <nb-card size="medium" status="basic" class="map-card">
      <nb-card-header class="map-title">
        üåç –ì–µ–æ–≥—Ä–∞—Ñ—ñ—è –∫—Ä–∏–ø—Ç–æ–º–æ–Ω–µ—Ç
      </nb-card-header>

      <nb-card-body class="map-body">
        <div id="map" class="leaflet-map"></div>
      </nb-card-body>
    </nb-card>
    
    <nb-layout-footer fixed class="footer-corporate">
      <div>
        &copy; 2025 ngx-admin-demo. –£—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ. |
        <a href="#">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</a> |
        <a href="#">–£–º–æ–≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è</a>
      </div>
    </nb-layout-footer>